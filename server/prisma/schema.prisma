generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Ticker {
  symbol   String  @id
  name     String?
  sector   String?
  industry String?

  bars     PriceBarDaily[]
  groups   GroupMember[]
  results  AnalysisResult[]
}

model Group {
  id      String @id @default(cuid())
  name    String
  type    String  // "manual" | "sector" | "cluster"
  members GroupMember[]
}

model GroupMember {
  groupId String
  symbol  String

  group   Group  @relation(fields: [groupId], references: [id], onDelete: Cascade)
  ticker  Ticker @relation(fields: [symbol], references: [symbol], onDelete: Cascade)

  @@id([groupId, symbol])
  @@index([symbol])
}

model PriceBarDaily {
  symbol String
  date   DateTime
  open   Float
  high   Float
  low    Float
  close  Float
  volume Float?

  ticker Ticker @relation(fields: [symbol], references: [symbol], onDelete: Cascade)

  @@id([symbol, date])
  @@index([date])
}

model AnalysisRun {
  id           String   @id @default(cuid())
  createdAt    DateTime @default(now())
  scope        String?  // e.g. "group:<id>" or "symbols:AAPL,MSFT"
  providerUsed String?
  parametersJson String? // JSON as string

  results      AnalysisResult[]
}

model AnalysisResult {
  id        String   @id @default(cuid())
  runId     String
  symbol    String

  metricsJson String?  // JSON as string
  signalsJson String?  // JSON as string

  run       AnalysisRun @relation(fields: [runId], references: [id], onDelete: Cascade)
  ticker    Ticker      @relation(fields: [symbol], references: [symbol], onDelete: Cascade)

  @@index([runId])
  @@index([symbol])
  @@unique([runId, symbol])
}
